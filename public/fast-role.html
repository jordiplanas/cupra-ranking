<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Fastest Role | CUPRA Awards</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">

<style>
@font-face {
  font-family: myFont;
  src: url(assets/Typo/Cupra-Regular.ttf);
}

:root{
  --bg-top:#1a2a3a;
  --bg-bottom:#0c1118;
  --card-top:#212832;
  --card-bottom:#141a22;
  --border:rgba(255,255,255,.15);

  --card-w:260px;
  --badge:68px;
}

/* GLOBAL */
body{
  margin:0;
  background:radial-gradient(circle at center, var(--bg-top), var(--bg-bottom));
  color:white;
  font-family:myFont, system-ui;
  padding:40px 20px;
  text-align:center;
}

/* Buttons small top-right */
.selector{
  position:absolute;
  top:20px;
  right:20px;
  display:flex;
  gap:10px;
}
.selector button{
  font-family:myFont;
  font-size:14px;
  padding:6px 14px;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:6px;
  color:white;
  cursor:pointer;
  transition:.2s;
}
.selector button:hover{
  background:rgba(255,255,255,0.15);
}

/* PODIUM */
.podium{
  display:flex;
  justify-content:center;
  align-items:flex-end;
  gap:26px;
  margin-top:80px;
  flex-wrap:wrap;
}

/* CARD */
.card{
  width:var(--card-w);
  background:linear-gradient(180deg,var(--card-top),var(--card-bottom));
  border-radius:18px;
  border:1px solid var(--border);
  padding:80px 20px 25px;
  text-align:center;
  position:relative;
  box-shadow:0 22px 40px rgba(0,0,0,.5);
}
.card.first{ transform:translateY(-18px) scale(1.08); }
.card.second{transform:translateY(0px) scale(1.03); opacity:.96;}
.card.third{ transform:translateY(10px) scale(1.00); opacity:.88; }

/* BADGE */
.badge{
  width:var(--badge);
  height:var(--badge);
  border-radius:50%;
  background:#0f1a24;
  border:1px solid var(--border);
  box-shadow:0 10px 20px rgba(0,0,0,.5);
  position:absolute;
  top:-34px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  font-size:40px;
}

/* OPTIONAL ICON FOR ROLES */
.badge span{
  font-size:38px;
}

/* TROPHY */
.trophy img{
  width:40px;
}

.name{
  font-size:20px;
  margin:6px 0 8px;
}
.position{
  margin-top:6px;
  opacity:0.6;
}
.duration{
  margin-top:10px;
  font-size:22px;
}
</style>
</head>

<body>

<h1>Fastest Roles</h1>

<div class="selector">
  <button onclick="loadFastest('electrification')">Electrification</button>
  <button onclick="loadFastest('brand')">Brand</button>
</div>

<div id="podium" class="podium"></div>

<script>
function roleIcon(role){
  const map={
    "Sales Manager":"ðŸ’¼",
    "Product Expert":"âš¡",
    "Marketing":"ðŸ“£",
    "Service Advisor":"ðŸ”§",
    "Dealer Principal":"ðŸ†"
  };
  return map[role]||"ðŸš€";
}

async function loadFastest(block){
  const res=await fetch('/api/ranking');
  const users=await res.json();

  const arr=[];

  users.forEach(u=>{
    const b=u.blocks.find(x=>x.name===block);
    if(b){
      arr.push({
        role:u.job_role||"N/A",
        duration:Number(b.duration)
      });
    }
  });

  arr.sort((a,b)=>a.duration-b.duration);
  const top3=arr.slice(0,3);

  const order=[2,0,1];
  const classes=["third","first","second"];
  const labels=["3rd Place","1st Place","2nd Place"];
  const icons={
    first:"assets/img/gold.png",
    second:"assets/img/silver.png",
    third:"assets/img/cooper.png"
  };

  document.getElementById("podium").innerHTML = order.map((pos,i)=>{
    const item=top3[pos]||{role:"-",duration:0};
    const cls = classes[i];
    const trophy = cls==="first"?icons.first : cls==="second"?icons.second:icons.third;

    return `
      <div class="card ${cls}">
        <div class="badge"><span>${roleIcon(item.role)}</span></div>

        <div class="name">${item.role}</div>

        <div class="trophy"><img src="${trophy}" /></div>

        <div class="position">${labels[i]}</div>

        <div class="duration">${item.duration.toFixed(1)} sec</div>
      </div>
    `;
  }).join('');
}
</script>

</body>
</html>