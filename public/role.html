<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Best Job Role | CUPRA Awards</title>

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    color: white;
    background: radial-gradient(circle at center, #1a2a3a 0%, #0c1118 70%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    overflow: hidden;
}

h1 {
    font-size: 60px;
    margin-bottom: 10px;
}

.subtitle {
    opacity: 0.7;
    margin-bottom: 60px;
}

.podium {
    display: flex;
    align-items: flex-end;
    gap: 40px;
}

.card {
    width: 300px;
    padding: 40px 20px;
    border-radius: 20px;
    background: linear-gradient(145deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    backdrop-filter: blur(20px);
    box-shadow: 0 25px 60px rgba(0,0,0,0.6);
    text-align: center;
    transition: all 0.5s ease;
}

.first { transform: scale(1.15); border:1px solid rgba(255,200,0,0.5); }
.second { transform: scale(1.05); opacity:0.95; }
.third { opacity:0.85; }

.position {
    font-size: 14px;
    margin-bottom: 10px;
    opacity: 0.7;
}

.name {
    font-size: 26px;
    margin-bottom: 20px;
}

.points {
    font-size: 40px;
    font-weight: bold;
}

footer {
    position: absolute;
    bottom: 30px;
    left: 40px;
    opacity: 0.6;
}
</style>
</head>
<body>

<h1>Best Job Role</h1>
<div class="subtitle">Award goes to:</div>

<div class="podium" id="podium"></div>

<footer>One of Us Awards 2026</footer>

<script>
async function loadRoles() {
    const res = await fetch('/api/ranking');
    const users = await res.json();

    const roleStats = {};

    users.forEach(u => {
        if (!roleStats[u.job_role]) {
            roleStats[u.job_role] = { total: 0, count: 0 };
        }
        roleStats[u.job_role].total += u.totalScore;
        roleStats[u.job_role].count += 1;
    });

    const top = Object.entries(roleStats)
        .map(([role, data]) => ({
            name: role,
            avg: data.total / data.count
        }))
        .sort((a,b) => b.avg - a.avg)
        .slice(0,3);

    renderPodium(top);
}

function renderPodium(data) {
    const order = [2,0,1]; // display 3rd, 1st, 2nd
    const classes = ["third","first","second"];
    const labels = ["3rd Place","1st Place","2nd Place"];

    const podium = document.getElementById("podium");

    podium.innerHTML = order.map((pos, i) => `
        <div class="card ${classes[i]}">
            <div class="position">${labels[i]}</div>
            <div class="name">${data[pos]?.name || "-"}</div>
            <div class="points">${data[pos]?.avg.toFixed(0) || "0"} Points</div>
        </div>
    `).join('');
}

loadRoles();
</script>

</body>
</html>
